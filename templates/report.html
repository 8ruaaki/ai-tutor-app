<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¡ç‚¹ãƒ¬ãƒãƒ¼ãƒˆ - AI Tutor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .score-box { text-align: center; padding: 30px; background: #fff; border-radius: 20px; margin-bottom: 25px; }
        .score-val { font-size: 3.5rem; font-weight: bold; color: var(--primary-color); }

        .feedback-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        .fb-card { padding: 15px; border-radius: 12px; font-size: 0.95rem; }
        .good-fb { background: #e8f5e9; border-left: 5px solid #4caf50; }
        .improve-fb { background: #fff3e0; border-left: 5px solid #ff9800; }

        .detail-card { 
            background: #fff; padding: 20px; border-radius: 12px; margin-bottom: 15px; 
            border-left: 10px solid #ddd; text-align: left;
        }
        .correct { border-left-color: #4caf50; }
        .wrong { border-left-color: #f44336; }
        .ans-row { display: flex; gap: 10px; margin: 5px 0; font-size: 0.9rem; }
        .label { font-weight: bold; min-width: 80px; }

        @media (max-width: 600px) {
            .feedback-grid { grid-template-columns: 1fr; }
        }
    </style>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']]
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };
</script>
</head>
<body>
    <div class="container" style="max-width: 800px;">
        <div class="score-box">
            <h1>æ¡ç‚¹çµæœ</h1>
            <div class="score-val"><span id="score-num">0</span><span style="font-size: 1rem;">ç‚¹</span></div>
        </div>

        <div class="feedback-grid">
            <div class="fb-card good-fb">
                <strong>ğŸŒŸ è‰¯ã‹ã£ãŸç‚¹</strong>
                <p id="good-points" style="margin-top:5px;"></p>
            </div>
            <div class="fb-card improve-fb">
                <strong>ğŸ’¡ æ”¹å–„ã‚¢ãƒ‰ãƒã‚¤ã‚¹</strong>
                <p id="improve-points" style="margin-top:5px;"></p>
            </div>
        </div>

        <div id="details-container"></div>


     <form id="homework-form">
    <div class="input-group">
        <label>åŸºç¤å•é¡Œï¼ˆå•ï¼‰ï¼š</label>
        <input type="number" id="count_basic" name="count_basic" value="2" min="0" max="30" style="width: 60px;">
    </div>

    <div class="input-group">
        <label>æ¨™æº–å•é¡Œï¼ˆå•ï¼‰ï¼š</label>
        <input type="number" id="count_normal" name="count_normal" value="2" min="0" max="30" style="width: 60px;">
    </div>

    <div class="input-group">
        <label>ç™ºå±•å•é¡Œï¼ˆå•ï¼‰ï¼š</label>
        <input type="number" id="count_advanced" name="count_advanced" value="1" min="0" max="30" style="width: 60px;">
    </div>
</form>

<div id="loading-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); z-index: 9999; flex-direction: column; align-items: center; justify-content: center;">
        <div class="loader"></div> 
        <p id="status-text" style="margin-top: 20px; font-weight: bold; color: var(--primary-color);">AIãŒä½œæˆä¸­...</p>
    </div>

<div style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top:30px;">
    <button onclick="generateHomework()" style="background:var(--primary-color); color:white;">å®¿é¡Œã‚’ç™ºè¡Œ</button>
    <button onclick="window.location.href='/'" style="background:#636e72; color:white;">ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</button>
</div>   
    </div>

<script>
        document.addEventListener('DOMContentLoaded', () => {
            const data = JSON.parse(sessionStorage.getItem('lastReport'));
            if (!data) return window.location.href = '/';

            document.getElementById('score-num').innerText = data.score;
            document.getElementById('good-points').innerText = data.good_points;
            document.getElementById('improve-points').innerText = data.improvement_points;

            const container = document.getElementById('details-container');
            
            // 1. ã¾ãšHTMLã‚’ç”Ÿæˆã—ã¦æµã—è¾¼ã‚€
            container.innerHTML = data.details.map((d, i) => `
                <div class="detail-card ${d.is_correct ? 'correct' : 'wrong'}">
                    <strong>å• ${i+1}: ${d.question}</strong>
                    <div class="ans-row"><span class="label">ã‚ãªãŸã®ç­”:</span><span>${d.user_answer || 'æœªå…¥åŠ›'}</span></div>
                    <div class="ans-row"><span class="label">æ­£è§£:</span><span style="color:#f44336; font-weight:bold;">${d.correct_answer}</span></div>
                    <div style="margin-top:10px; padding:10px; background:#f9f9f9; border-radius:5px; font-size:0.85rem;">${d.explanation}</div>
                </div>
            `).join('');

            // 2. ã€é‡è¦ã€‘HTMLã‚’æãçµ‚ãˆãŸå¾Œã€MathJaxã«æ•°å¼ã®å¤‰æ›ã‚’å‘½ã˜ã‚‹
            if (window.MathJax && window.MathJax.typesetPromise) {
                MathJax.typesetPromise([container]).catch((err) => console.log('MathJax error: ', err));
            }
        });
    </script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>